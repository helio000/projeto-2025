<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style2.css">
<title>Sala de Alunos</title>
<style>
html, body { height: 100%; margin: 0; padding: 0; }
body {
    font-family: Arial, sans-serif;
    color: white;
    background-image: url('fotos/fundoForm2.png');
    background-size: center;
    background-position: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
}
.conteudo {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}
.Informações { text-align: center; font-size: 28px; margin: 20px 0; text-shadow: 1px 1px 5px black; }
#filtros { display: flex; gap: 10px; margin-bottom: 20px; }
#filtros button { padding: 8px 15px; border: none; border-radius: 5px; background-color: #28a745; color: white; cursor: pointer; transition: 0.3s; }
#filtros button:hover { background-color: #218838; }
#lista-sala {
    width: 90%; max-width: 800px; margin-bottom: 20px; padding: 20px;
    background-color: rgba(0,0,0,0.7); border-radius: 10px;
    display: flex; flex-direction: column; gap: 15px; min-height: 50px;
}
.aluno {
    background-color: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px;
    display: flex; flex-direction: column; gap: 5px;
}
.aluno p { margin: 0; }
.remover { align-self: flex-start; padding: 5px 10px; border: none; border-radius: 5px; background-color: red; color: white; cursor: pointer; }
.remover:hover { background-color: darkred; }
#voltar-home {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    background-color: #007bff;
    color: white;
    cursor: pointer;
    transition: 0.3s;
    margin-top: auto;
    margin-bottom: 20px;
}
#voltar-home:hover { background-color: #0056b3; }
@media (max-width: 600px) {
    #lista-sala { padding: 15px; }
    .Informações { font-size: 22px; }
    #filtros { flex-direction: column; gap: 5px; }
}
</style>
</head>
<body>

<div class="conteudo">
    <h5 class="Informações">Sala de Alunos</h5>
    <div id="filtros">
        <button data-arte="">Todos</button>
        <button data-arte="capoeira">Capoeira</button>
        <button data-arte="jiu-jitsu">Jiu-Jitsu</button>
        <button data-arte="karate">Karatê</button>
    </div>
    <fieldset id="lista-sala"></fieldset>
</div>

<button id="voltar-home">Voltar para Home</button>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    const lista = document.getElementById("lista-sala");
    const botoes = document.querySelectorAll("#filtros button");
    let alunos = [];

    document.getElementById("voltar-home").addEventListener("click", () => {
        window.location.href = "home.html";
    });

    async function carregarAlunos() {
        try {
            const resposta = await fetch('http://localhost:3100/alunos');
            if (!resposta.ok) throw new Error("Erro ao buscar alunos");
            alunos = await resposta.json();
            localStorage.setItem('alunos', JSON.stringify(alunos));
            atualizarLista();
        } catch (err) {
            console.error("Erro ao carregar alunos:", err);
            const dadosLocal = localStorage.getItem('alunos');
            if (dadosLocal) {
                alunos = JSON.parse(dadosLocal);
                atualizarLista();
            }
        }
    }

    async function removerAluno(id) {
        try {
            const resposta = await fetch(`http://localhost:3100/alunos/${id}`, { method: "DELETE" });
            if (!resposta.ok) throw new Error("Erro ao remover aluno");
            alunos = alunos.filter(a => a.id !== id);
            localStorage.setItem('alunos', JSON.stringify(alunos));
            atualizarLista();
        } catch (err) {
            console.error(err);
            alert("Não foi possível remover o aluno.");
        }
    }

    function atualizarLista(filtro = "") {
        lista.innerHTML = "";
        const filtrados = filtro ? alunos.filter(a => a.arteMarcial === filtro) : alunos;

        if (filtrados.length === 0) {
            const p = document.createElement("p");
            p.textContent = "Nenhum aluno cadastrado.";
            lista.appendChild(p);
        } else {
            filtrados.forEach(aluno => {
                const div = document.createElement("div");
                div.classList.add("aluno");

                div.innerHTML = `
                    <p><strong>Nome:</strong> ${aluno.nome}</p>
                    <p><strong>RA:</strong> ${aluno.RA}</p>
                    <p><strong>Email:</strong> ${aluno.email}</p>
                    <p><strong>Telefone:</strong> ${aluno.telefone}</p>
                    <p><strong>Arte Marcial:</strong> ${aluno.arteMarcial}</p>
                    <p><strong>Data de Nascimento:</strong> ${aluno.datanasc ? aluno.datanasc.split('T')[0] : ''}</p>
                    <button class="remover">Remover</button>
                `;

                lista.appendChild(div);

                div.querySelector(".remover").addEventListener("click", () => {
                    removerAluno(aluno.id);
                });
            });
        }
    }

    botoes.forEach(btn => {
        btn.addEventListener("click", () => {
            const arte = btn.getAttribute("data-arte");
            atualizarLista(arte);
        });
    });

    await carregarAlunos();
});
</script>

</body>
</html>

